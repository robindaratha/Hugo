<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>WMI Berechtigungen via Powershell | </title><meta name=keywords content="Powershell,How-To,Windows,Skripte"><meta name=description content="Einführung WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: Matrix42 Supportseite
Skript Nachfolgend ist das Skript zu finden:
# Copyright (c) Microsoft Corporation. All rights reserved. # For personal use only. Provided AS IS and WITH ALL FAULTS. # Set-WmiNamespaceSecurity.ps1 # Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess # Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646 # Modified by Stuart Clarkson (https://github."><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/wmi-berechtigungen-via-powershell/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css integrity="sha256-v1+fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/wmi-berechtigungen-via-powershell/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="WMI Berechtigungen via Powershell"><meta property="og:description" content="Einführung WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: Matrix42 Supportseite
Skript Nachfolgend ist das Skript zu finden:
# Copyright (c) Microsoft Corporation. All rights reserved. # For personal use only. Provided AS IS and WITH ALL FAULTS. # Set-WmiNamespaceSecurity.ps1 # Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess # Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646 # Modified by Stuart Clarkson (https://github."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/wmi-berechtigungen-via-powershell/"><meta property="og:image" content="http://localhost:1313/47"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-09T20:30:26+02:00"><meta property="article:modified_time" content="2024-07-09T20:30:26+02:00"><meta property="og:site_name" content="Homepage"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/47"><meta name=twitter:title content="WMI Berechtigungen via Powershell"><meta name=twitter:description content="Einführung WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: Matrix42 Supportseite
Skript Nachfolgend ist das Skript zu finden:
# Copyright (c) Microsoft Corporation. All rights reserved. # For personal use only. Provided AS IS and WITH ALL FAULTS. # Set-WmiNamespaceSecurity.ps1 # Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess # Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646 # Modified by Stuart Clarkson (https://github."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"WMI Berechtigungen via Powershell","item":"http://localhost:1313/posts/wmi-berechtigungen-via-powershell/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"WMI Berechtigungen via Powershell","name":"WMI Berechtigungen via Powershell","description":"Einführung WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: Matrix42 Supportseite\nSkript Nachfolgend ist das Skript zu finden:\n# Copyright (c) Microsoft Corporation. All rights reserved. # For personal use only. Provided AS IS and WITH ALL FAULTS. # Set-WmiNamespaceSecurity.ps1 # Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess # Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646 # Modified by Stuart Clarkson (https://github.","keywords":["Powershell","How-To","Windows","Skripte"],"articleBody":"Einführung WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: Matrix42 Supportseite\nSkript Nachfolgend ist das Skript zu finden:\n# Copyright (c) Microsoft Corporation. All rights reserved. # For personal use only. Provided AS IS and WITH ALL FAULTS. # Set-WmiNamespaceSecurity.ps1 # Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess # Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646 # Modified by Stuart Clarkson (https://github.com/Tras2) Param ( [parameter(Mandatory=$true,Position=0)] [String] $namespace, [parameter(Mandatory=$true,Position=1)] [ValidateSet(\"Add\",\"Delete\")] [String] $operation, [parameter(Mandatory=$true,Position=2)] [string] $account, [parameter(Position=3)] [ValidateSet(\"Enable\",\"MethodExecute\",\"FullWrite\",\"PartialWrite\", ` \"ProviderWrite\",\"RemoteAccess\",\"ReadSecurity\",\"WriteSecurity\")] [string[]] $permissions = $null, [Parameter()][ValidateSet(\"User\",\"Group\")] [String]$AccountType = \"User\", [Switch]$allowInherit, [Switch]$deny, [string] $computerName = \".\", [System.Management.Automation.PSCredential] $credential = $null ) Process { $ErrorActionPreference = \"Stop\" Function Get-AccessMaskFromPermission($permissions) { $WBEM_ENABLE = 1 $WBEM_METHOD_EXECUTE = 2 $WBEM_FULL_WRITE_REP = 4 $WBEM_PARTIAL_WRITE_REP = 8 $WBEM_WRITE_PROVIDER = 0x10 $WBEM_REMOTE_ACCESS = 0x20 $WBEM_RIGHT_SUBSCRIBE = 0x40 $WBEM_RIGHT_PUBLISH = 0x80 $READ_CONTROL = 0x20000 $WRITE_DAC = 0x40000 $WBEM_RIGHTS_FLAGS = $WBEM_ENABLE,$WBEM_METHOD_EXECUTE,$WBEM_FULL_WRITE_REP,` $WBEM_PARTIAL_WRITE_REP,$WBEM_WRITE_PROVIDER,$WBEM_REMOTE_ACCESS,` $READ_CONTROL,$WRITE_DAC $WBEM_RIGHTS_STRINGS = \"Enable\",\"MethodExecute\",\"FullWrite\",\"PartialWrite\",` \"ProviderWrite\",\"RemoteAccess\",\"ReadSecurity\",\"WriteSecurity\" $permissionTable = @{} for ($i = 0; $i -lt $WBEM_RIGHTS_FLAGS.Length; $i++) { $permissionTable.Add($WBEM_RIGHTS_STRINGS[$i].ToLower(), $WBEM_RIGHTS_FLAGS[$i]) } $accessMask = 0 foreach ($permission in $permissions) { if (-not $permissionTable.ContainsKey($permission.ToLower())) { throw \"Unknown permission: $permission`nValid permissions: $($permissionTable.Keys)\" } $accessMask += $permissionTable[$permission.ToLower()] } $accessMask } if ($PSBoundParameters.ContainsKey(\"Credential\")) { $remoteparams = @{ComputerName=$computerName;Credential=$credential} } else { $remoteparams = @{ComputerName=$computerName} } $invokeparams = @{Namespace=$namespace;Path=\"__systemsecurity=@\"} + $remoteParams $output = Invoke-WmiMethod @invokeparams -Name GetSecurityDescriptor if ($output.ReturnValue -ne 0) { throw \"GetSecurityDescriptor failed: $($output.ReturnValue)\" } $acl = $output.Descriptor $OBJECT_INHERIT_ACE_FLAG = 0x1 $CONTAINER_INHERIT_ACE_FLAG = 0x2 $computerName = (Get-WmiObject @remoteparams Win32_ComputerSystem).Name if ($account.Contains('\\')) { $domainaccount = $account.Split('\\') $domain = $domainaccount[0] if (($domain -eq \".\") -or ($domain -eq \"BUILTIN\")) { $domain = $computerName } $accountname = $domainaccount[1] } elseif ($account.Contains('@')) { $domainaccount = $account.Split('@') $domain = $domainaccount[1].Split('.')[0] $accountname = $domainaccount[0] } else { $domain = $computerName $accountname = $account } if ($AccountType -eq \"Group\") { $getparams = @{Class=\"Win32_Group\"} } else { $getparams = @{Class=\"Win32_Account\"} } $getparams+= @{Filter=\"Domain='$domain' and Name='$accountname'\"} + $remoteParams $win32account = Get-WmiObject @getparams if ($win32account -eq $null) { throw \"Account was not found: $account\" } switch ($operation) { \"Add\" { if ($permissions -eq $null) { throw \"-Permissions must be specified for an add operation\" } $accessMask = Get-AccessMaskFromPermission($permissions) $ace = (New-Object System.Management.ManagementClass(\"win32_Ace\")).CreateInstance() $ace.AccessMask = $accessMask if ($allowInherit) { $ace.AceFlags = $CONTAINER_INHERIT_ACE_FLAG } else { $ace.AceFlags = 0 } $trustee = (New-Object System.Management.ManagementClass(\"win32_Trustee\")).CreateInstance() $trustee.SidString = $win32account.Sid $ace.Trustee = $trustee $ACCESS_ALLOWED_ACE_TYPE = 0x0 $ACCESS_DENIED_ACE_TYPE = 0x1 if ($deny) { $ace.AceType = $ACCESS_DENIED_ACE_TYPE } else { $ace.AceType = $ACCESS_ALLOWED_ACE_TYPE } $acl.DACL += $ace.psobject.immediateBaseObject } \"Delete\" { if ($permissions -ne $null) { throw \"Permissions cannot be specified for a delete operation\" } [System.Management.ManagementBaseObject[]]$newDACL = @() foreach ($ace in $acl.DACL) { if ($ace.Trustee.SidString -ne $win32account.Sid) { $newDACL += $ace.psobject.immediateBaseObject } } $acl.DACL = $newDACL.psobject.immediateBaseObject } default { throw \"Unknown operation: $operation`nAllowed operations: add delete\" } } $setparams = @{Name=\"SetSecurityDescriptor\";ArgumentList=$acl.psobject.immediateBaseObject} + $invokeParams $output = Invoke-WmiMethod @setparams if ($output.ReturnValue -ne 0) { throw \"SetSecurityDescriptor failed: $($output.ReturnValue)\" } } Speichert das Skript unter “Set-WmiNamespaceSecurity.ps1” ab und führt die folgende Syntax für die jewiligen Benutzer aus:\n.\\Set-WmiNamespaceSecurity.ps1 root/\u003cwmi namespace\u003e add \u003cuseraccount\u003e Enable,RemoteAccess ","wordCount":"497","inLanguage":"en","datePublished":"2024-07-09T20:30:26+02:00","dateModified":"2024-07-09T20:30:26+02:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/wmi-berechtigungen-via-powershell/"},"publisher":{"@type":"Organization","name":"","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/posts/ title=Beiträge><span>Beiträge</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/about/ title=About><span>About</span></a></li><li><a href=https://daratha.net title=Startseite><span>Startseite</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=http://localhost:1313/search/ title=Suche><span>Suche</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class=post-title>WMI Berechtigungen via Powershell</h1><div class=post-meta>&lt;span title='2024-07-09 20:30:26 +0200 CEST'>09 Jul 2024&lt;/span>&amp;nbsp;·&amp;nbsp;3 min&amp;nbsp;·&amp;nbsp;497 words&amp;nbsp;·&amp;nbsp;Me</div></header><div class=post-content><h1 id=einführung>Einführung<a hidden class=anchor aria-hidden=true href=#einführung>#</a></h1><p>WMI Berechtigungen müssen z.B. für Inventory Serviceaccounts eingerichtet werden, wenn diese keine lokalen Administartrorenrechte auf dem jeweiligen System haben sollen. Hier ein Beispiel von Matrix42: <a href=https://help.matrix42.com/020_ESM/10_Service_Management/010ServiceStore_Platform_Guide/030Integration/Built-in_data_providers/Virtual_infrastructure%2C_software%2C_and_hardware_inventory/Prerequisites_for_Windows_inventory>Matrix42 Supportseite</a></p><h1 id=skript>Skript<a hidden class=anchor aria-hidden=true href=#skript>#</a></h1><p>Nachfolgend ist das Skript zu finden:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Copyright (c) Microsoft Corporation.  All rights reserved. </span>
</span></span><span class=line><span class=cl><span class=c># For personal use only.  Provided AS IS and WITH ALL FAULTS.</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c># Set-WmiNamespaceSecurity.ps1</span>
</span></span><span class=line><span class=cl><span class=c># Example: Set-WmiNamespaceSecurity root/cimv2 add steve Enable,RemoteAccess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Taken from https://live.paloaltonetworks.com/t5/Management-Articles/PowerShell-Script-for-setting-WMI-Permissions-for-User-ID/ta-p/53646</span>
</span></span><span class=line><span class=cl><span class=c># Modified by Stuart Clarkson (https://github.com/Tras2)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>Param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>=</span><span class=vm>$true</span><span class=p>,</span><span class=na>Position</span><span class=p>=</span><span class=mf>0</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>String</span><span class=p>]</span> <span class=nv>$namespace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>=</span><span class=vm>$true</span><span class=p>,</span><span class=na>Position</span><span class=p>=</span><span class=mf>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s2>&#34;Add&#34;</span><span class=p>,</span><span class=s2>&#34;Delete&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>String</span><span class=p>]</span> <span class=nv>$operation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span><span class=p>=</span><span class=vm>$true</span><span class=p>,</span><span class=na>Position</span><span class=p>=</span><span class=mf>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>string</span><span class=p>]</span> <span class=nv>$account</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Position</span><span class=p>=</span><span class=mf>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s2>&#34;Enable&#34;</span><span class=p>,</span><span class=s2>&#34;MethodExecute&#34;</span><span class=p>,</span><span class=s2>&#34;FullWrite&#34;</span><span class=p>,</span><span class=s2>&#34;PartialWrite&#34;</span><span class=p>,</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;ProviderWrite&#34;</span><span class=p>,</span><span class=s2>&#34;RemoteAccess&#34;</span><span class=p>,</span><span class=s2>&#34;ReadSecurity&#34;</span><span class=p>,</span><span class=s2>&#34;WriteSecurity&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>string[]</span><span class=p>]</span> <span class=nv>$permissions</span> <span class=p>=</span> <span class=vm>$null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>Parameter</span><span class=p>()][</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s2>&#34;User&#34;</span><span class=p>,</span><span class=s2>&#34;Group&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>String</span><span class=p>]</span><span class=nv>$AccountType</span> <span class=p>=</span> <span class=s2>&#34;User&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Switch</span><span class=p>]</span><span class=nv>$allowInherit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>Switch</span><span class=p>]</span><span class=nv>$deny</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>string</span><span class=p>]</span> <span class=nv>$computerName</span> <span class=p>=</span> <span class=s2>&#34;.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>System.Management.Automation.PSCredential</span><span class=p>]</span> <span class=nv>$credential</span> <span class=p>=</span> <span class=vm>$null</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=k>Process</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ErrorActionPreference</span> <span class=p>=</span> <span class=s2>&#34;Stop&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=kd>Function</span><span class=w> </span><span class=nb>Get-AccessMaskFromPermission($permissions</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$WBEM_ENABLE</span>            <span class=p>=</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_METHOD_EXECUTE</span> <span class=p>=</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_FULL_WRITE_REP</span>   <span class=p>=</span> <span class=mf>4</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_PARTIAL_WRITE_REP</span>              <span class=p>=</span> <span class=mf>8</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_WRITE_PROVIDER</span>   <span class=p>=</span> <span class=n>0x10</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_REMOTE_ACCESS</span>    <span class=p>=</span> <span class=n>0x20</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_RIGHT_SUBSCRIBE</span> <span class=p>=</span> <span class=n>0x40</span>
</span></span><span class=line><span class=cl>                <span class=nv>$WBEM_RIGHT_PUBLISH</span>      <span class=p>=</span> <span class=n>0x80</span>
</span></span><span class=line><span class=cl>        <span class=nv>$READ_CONTROL</span> <span class=p>=</span> <span class=n>0x20000</span>
</span></span><span class=line><span class=cl>        <span class=nv>$WRITE_DAC</span> <span class=p>=</span> <span class=n>0x40000</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=nv>$WBEM_RIGHTS_FLAGS</span> <span class=p>=</span> <span class=nv>$WBEM_ENABLE</span><span class=p>,</span><span class=nv>$WBEM_METHOD_EXECUTE</span><span class=p>,</span><span class=nv>$WBEM_FULL_WRITE_REP</span><span class=p>,`</span>
</span></span><span class=line><span class=cl>            <span class=nv>$WBEM_PARTIAL_WRITE_REP</span><span class=p>,</span><span class=nv>$WBEM_WRITE_PROVIDER</span><span class=p>,</span><span class=nv>$WBEM_REMOTE_ACCESS</span><span class=p>,`</span>
</span></span><span class=line><span class=cl>            <span class=nv>$READ_CONTROL</span><span class=p>,</span><span class=nv>$WRITE_DAC</span>
</span></span><span class=line><span class=cl>        <span class=nv>$WBEM_RIGHTS_STRINGS</span> <span class=p>=</span> <span class=s2>&#34;Enable&#34;</span><span class=p>,</span><span class=s2>&#34;MethodExecute&#34;</span><span class=p>,</span><span class=s2>&#34;FullWrite&#34;</span><span class=p>,</span><span class=s2>&#34;PartialWrite&#34;</span><span class=p>,`</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ProviderWrite&#34;</span><span class=p>,</span><span class=s2>&#34;RemoteAccess&#34;</span><span class=p>,</span><span class=s2>&#34;ReadSecurity&#34;</span><span class=p>,</span><span class=s2>&#34;WriteSecurity&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=nv>$permissionTable</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=p>=</span> <span class=mf>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>-lt</span> <span class=nv>$WBEM_RIGHTS_FLAGS</span><span class=p>.</span><span class=n>Length</span><span class=p>;</span> <span class=nv>$i</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$permissionTable</span><span class=p>.</span><span class=py>Add</span><span class=p>(</span><span class=nv>$WBEM_RIGHTS_STRINGS</span><span class=p>[</span><span class=nv>$i</span><span class=p>].</span><span class=py>ToLower</span><span class=p>(),</span> <span class=nv>$WBEM_RIGHTS_FLAGS</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=nv>$accessMask</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$permission</span> <span class=k>in</span> <span class=nv>$permissions</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$permissionTable</span><span class=p>.</span><span class=py>ContainsKey</span><span class=p>(</span><span class=nv>$permission</span><span class=p>.</span><span class=py>ToLower</span><span class=p>()))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=s2>&#34;Unknown permission: </span><span class=nv>$permission</span><span class=se>`n</span><span class=s2>Valid permissions: </span><span class=p>$(</span><span class=nv>$permissionTable</span><span class=p>.</span><span class=n>Keys</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nv>$accessMask</span> <span class=p>+=</span> <span class=nv>$permissionTable</span><span class=p>[</span><span class=nv>$permission</span><span class=p>.</span><span class=py>ToLower</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=nv>$accessMask</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$PSBoundParameters</span><span class=p>.</span><span class=py>ContainsKey</span><span class=p>(</span><span class=s2>&#34;Credential&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$remoteparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>ComputerName</span><span class=p>=</span><span class=nv>$computerName</span><span class=p>;</span><span class=n>Credential</span><span class=p>=</span><span class=nv>$credential</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$remoteparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>ComputerName</span><span class=p>=</span><span class=nv>$computerName</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>    <span class=nv>$invokeparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>Namespace</span><span class=p>=</span><span class=nv>$namespace</span><span class=p>;</span><span class=n>Path</span><span class=p>=</span><span class=s2>&#34;__systemsecurity=@&#34;</span><span class=p>}</span> <span class=p>+</span> <span class=nv>$remoteParams</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$output</span> <span class=p>=</span> <span class=nb>Invoke-WmiMethod</span> <span class=nv>@invokeparams</span> <span class=n>-Name</span> <span class=n>GetSecurityDescriptor</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$output</span><span class=p>.</span><span class=py>ReturnValue</span> <span class=o>-ne</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=s2>&#34;GetSecurityDescriptor failed: </span><span class=p>$(</span><span class=nv>$output</span><span class=p>.</span><span class=n>ReturnValue</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$acl</span> <span class=p>=</span> <span class=nv>$output</span><span class=p>.</span><span class=py>Descriptor</span>
</span></span><span class=line><span class=cl>    <span class=nv>$OBJECT_INHERIT_ACE_FLAG</span> <span class=p>=</span> <span class=n>0x1</span>
</span></span><span class=line><span class=cl>    <span class=nv>$CONTAINER_INHERIT_ACE_FLAG</span> <span class=p>=</span> <span class=n>0x2</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$computerName</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Get-WmiObject</span> <span class=nv>@remoteparams</span> <span class=n>Win32_ComputerSystem</span><span class=p>).</span><span class=py>Name</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$account</span><span class=p>.</span><span class=py>Contains</span><span class=p>(</span><span class=s1>&#39;\&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$domainaccount</span> <span class=p>=</span> <span class=nv>$account</span><span class=p>.</span><span class=py>Split</span><span class=p>(</span><span class=s1>&#39;\&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>$domain</span> <span class=p>=</span> <span class=nv>$domainaccount</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=nv>$domain</span> <span class=o>-eq</span> <span class=s2>&#34;.&#34;</span><span class=p>)</span> <span class=o>-or</span> <span class=p>(</span><span class=nv>$domain</span> <span class=o>-eq</span> <span class=s2>&#34;BUILTIN&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$domain</span> <span class=p>=</span> <span class=nv>$computerName</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$accountname</span> <span class=p>=</span> <span class=nv>$domainaccount</span><span class=p>[</span><span class=mf>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$account</span><span class=p>.</span><span class=py>Contains</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$domainaccount</span> <span class=p>=</span> <span class=nv>$account</span><span class=p>.</span><span class=py>Split</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>$domain</span> <span class=p>=</span> <span class=nv>$domainaccount</span><span class=p>[</span><span class=mf>1</span><span class=p>].</span><span class=py>Split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nv>$accountname</span> <span class=p>=</span> <span class=nv>$domainaccount</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$domain</span> <span class=p>=</span> <span class=nv>$computerName</span>
</span></span><span class=line><span class=cl>        <span class=nv>$accountname</span> <span class=p>=</span> <span class=nv>$account</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$AccountType</span> <span class=o>-eq</span> <span class=s2>&#34;Group&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$getparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>Class</span><span class=p>=</span><span class=s2>&#34;Win32_Group&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$getparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>Class</span><span class=p>=</span><span class=s2>&#34;Win32_Account&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$getparams</span><span class=p>+=</span> <span class=vm>@</span><span class=p>{</span><span class=k>Filter</span><span class=p>=</span><span class=s2>&#34;Domain=&#39;</span><span class=nv>$domain</span><span class=s2>&#39; and Name=&#39;</span><span class=nv>$accountname</span><span class=s2>&#39;&#34;</span><span class=p>}</span> <span class=p>+</span> <span class=nv>$remoteParams</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$win32account</span> <span class=p>=</span> <span class=nb>Get-WmiObject</span> <span class=nv>@getparams</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$win32account</span> <span class=o>-eq</span> <span class=vm>$null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=s2>&#34;Account was not found: </span><span class=nv>$account</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$operation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Add&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$permissions</span> <span class=o>-eq</span> <span class=vm>$null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=s2>&#34;-Permissions must be specified for an add operation&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nv>$accessMask</span> <span class=p>=</span> <span class=nb>Get-AccessMaskFromPermission</span><span class=p>(</span><span class=nv>$permissions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>            <span class=nv>$ace</span> <span class=p>=</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>ManagementClass</span><span class=p>(</span><span class=s2>&#34;win32_Ace&#34;</span><span class=p>)).</span><span class=py>CreateInstance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nv>$ace</span><span class=p>.</span><span class=py>AccessMask</span> <span class=p>=</span> <span class=nv>$accessMask</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$allowInherit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ace</span><span class=p>.</span><span class=py>AceFlags</span> <span class=p>=</span> <span class=nv>$CONTAINER_INHERIT_ACE_FLAG</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ace</span><span class=p>.</span><span class=py>AceFlags</span> <span class=p>=</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>                       
</span></span><span class=line><span class=cl>            <span class=nv>$trustee</span> <span class=p>=</span> <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>ManagementClass</span><span class=p>(</span><span class=s2>&#34;win32_Trustee&#34;</span><span class=p>)).</span><span class=py>CreateInstance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nv>$trustee</span><span class=p>.</span><span class=py>SidString</span> <span class=p>=</span> <span class=nv>$win32account</span><span class=p>.</span><span class=py>Sid</span>
</span></span><span class=line><span class=cl>            <span class=nv>$ace</span><span class=p>.</span><span class=py>Trustee</span> <span class=p>=</span> <span class=nv>$trustee</span>
</span></span><span class=line><span class=cl>           
</span></span><span class=line><span class=cl>            <span class=nv>$ACCESS_ALLOWED_ACE_TYPE</span> <span class=p>=</span> <span class=n>0x0</span>
</span></span><span class=line><span class=cl>            <span class=nv>$ACCESS_DENIED_ACE_TYPE</span> <span class=p>=</span> <span class=n>0x1</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$deny</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ace</span><span class=p>.</span><span class=py>AceType</span> <span class=p>=</span> <span class=nv>$ACCESS_DENIED_ACE_TYPE</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ace</span><span class=p>.</span><span class=py>AceType</span> <span class=p>=</span> <span class=nv>$ACCESS_ALLOWED_ACE_TYPE</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>            <span class=nv>$acl</span><span class=p>.</span><span class=py>DACL</span> <span class=p>+=</span> <span class=nv>$ace</span><span class=p>.</span><span class=py>psobject</span><span class=p>.</span><span class=py>immediateBaseObject</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Delete&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nv>$permissions</span> <span class=o>-ne</span> <span class=vm>$null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>throw</span> <span class=s2>&#34;Permissions cannot be specified for a delete operation&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=no>System.Management.ManagementBaseObject[]</span><span class=p>]</span><span class=nv>$newDACL</span> <span class=p>=</span> <span class=vm>@</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span> <span class=p>(</span><span class=nv>$ace</span> <span class=k>in</span> <span class=nv>$acl</span><span class=p>.</span><span class=n>DACL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nv>$ace</span><span class=p>.</span><span class=py>Trustee</span><span class=p>.</span><span class=py>SidString</span> <span class=o>-ne</span> <span class=nv>$win32account</span><span class=p>.</span><span class=n>Sid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$newDACL</span> <span class=p>+=</span> <span class=nv>$ace</span><span class=p>.</span><span class=py>psobject</span><span class=p>.</span><span class=py>immediateBaseObject</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>            <span class=nv>$acl</span><span class=p>.</span><span class=py>DACL</span> <span class=p>=</span> <span class=nv>$newDACL</span><span class=p>.</span><span class=py>psobject</span><span class=p>.</span><span class=py>immediateBaseObject</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=s2>&#34;Unknown operation: </span><span class=nv>$operation</span><span class=se>`n</span><span class=s2>Allowed operations: add delete&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$setparams</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span><span class=n>Name</span><span class=p>=</span><span class=s2>&#34;SetSecurityDescriptor&#34;</span><span class=p>;</span><span class=n>ArgumentList</span><span class=p>=</span><span class=nv>$acl</span><span class=p>.</span><span class=py>psobject</span><span class=p>.</span><span class=n>immediateBaseObject</span><span class=p>}</span> <span class=p>+</span> <span class=nv>$invokeParams</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nv>$output</span> <span class=p>=</span> <span class=nb>Invoke-WmiMethod</span> <span class=nv>@setparams</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$output</span><span class=p>.</span><span class=py>ReturnValue</span> <span class=o>-ne</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=s2>&#34;SetSecurityDescriptor failed: </span><span class=p>$(</span><span class=nv>$output</span><span class=p>.</span><span class=n>ReturnValue</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Speichert das Skript unter &ldquo;Set-WmiNamespaceSecurity.ps1&rdquo; ab und führt die folgende Syntax für die jewiligen Benutzer aus:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=nb>Set-WmiNamespaceSecurity</span><span class=p>.</span><span class=py>ps1</span> <span class=n>root</span><span class=p>/&lt;</span><span class=n>wmi</span> <span class=n>namespace</span><span class=p>&gt;</span> <span class=n>add</span> <span class=p>&lt;</span><span class=n>useraccount</span><span class=p>&gt;</span> <span class=n>Enable</span><span class=p>,</span><span class=n>RemoteAccess</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/powershell/>Powershell</a></li><li><a href=http://localhost:1313/tags/how-to/>How-To</a></li><li><a href=http://localhost:1313/tags/windows/>Windows</a></li><li><a href=http://localhost:1313/tags/skripte/>Skripte</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/fileserver-lcx-in-proxmox/><span class=title>Next »</span><br><span>Fileserver LCX in Proxmox</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/></a></span><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>